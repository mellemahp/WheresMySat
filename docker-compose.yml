version: '3.2'
networks: 
    postgres-network: 
    grafana-data:
services: 
    userdb: 
        image: library/postgres:latest
        volumes: 
            - type: bind
              source: /tmp/pgdata
              target: /var/lib/postgresql/data
        environment: 
            - POSTGRES_USER=flaskapp
            - POSTGRES_PASSWORD=foo
            - POSTGRES_DB=flaskapp
        networks: 
            - postgres-network
        container_name: "userdb"
            
    frontend: 
        build: ./frontend
        ports: 
            - "5000:5000"
        volumes: 
            - type: bind
              source: ./frontend/assets/static
              target: /usr/app/static
            - type: bind
              source: ./frontend/assets/templates
              target: /usr/app/templates
        networks: 
            - postgres-network 
        depends_on: 
            - userdb

    grafana: 
        image: grafana/grafana:latest
        ports: 
            - "3000:3000"
        environment: 
            - GF_SERVER_ROOT_URL=http://grafana.server.name
            - GF_SECURITY_ADMIN_PASSWORD=secret
        networks: 
            - grafana-data
        